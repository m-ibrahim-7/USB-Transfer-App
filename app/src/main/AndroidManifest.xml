<?xml version="1.0" encoding="utf-8"?>
<!--
    AndroidManifest.xml  —  Bridge v5
    ══════════════════════════════════════════════════════════════════════════
    CRITICAL CHANGES vs v4
    ───────────────────────
    1. FOREGROUND_SERVICE and FOREGROUND_SERVICE_DATA_SYNC REMOVED
       These permissions caused every single crash in your log.
       OverlayService no longer calls startForeground() so these are
       not needed and must not be present (they caused the SecurityException
       even when declared, on certain ROM builds).

    2. foregroundServiceType attribute REMOVED from <service>
       No longer applicable without startForeground().

    3. Only two permissions remain:
       • SYSTEM_ALERT_WINDOW  — required for the overlay bubble window
       • WAKE_LOCK            — kept as optional safety net (harmless if unused)

    WHAT YOU NEED TO DO
    ────────────────────
    Open your actual AndroidManifest.xml and make sure it matches this file
    exactly for the <uses-permission> and <service> blocks.
    Then rebuild and reinstall the APK.
-->
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.ophtho.usbtransfer">

    <!-- ── The ONLY permissions this app needs ────────────────────────── -->
    <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />

    <!-- ── DO NOT add these — they cause the crash: ───────────────────── -->
    <!-- <uses-permission android:name="android.permission.FOREGROUND_SERVICE" /> -->
    <!-- <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" /> -->

    <application
        android:allowBackup="true"
        android:label="Ophtho Bridge"
        android:theme="@style/Theme.UsbTransfer">

        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
            <intent-filter>
                <action android:name="android.intent.action.SEND" />
                <category android:name="android.intent.category.DEFAULT" />
                <data android:mimeType="text/plain" />
            </intent-filter>
        </activity>

        <!--
            NOTE: No foregroundServiceType attribute — we are a plain Service now.
            START_STICKY still works without foreground; the OS will restart us
            if killed, and the overlay window keeps the process alive regardless.
        -->
        <service
            android:name=".OverlayService"
            android:exported="false" />

    </application>
</manifest>
